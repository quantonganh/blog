---

kind: pipeline
name: default

platform:
  os: linux
  arch: arm

steps:
  - name: go-mod
    image: golang:1.13-alpine3.10-arm
    commands:
      - go mod vendor
    environment:
      GO111MODULE: "on"

  - name: static-check
    image: golangci/golangci-lint:armv7
    commands:
      - golangci-lint run --deadline 2m -v ./...
    environment:
      CGO_ENABLED: 0
      GO111MODULE: "on"

  - name: test
    image: golang:1.13-alpine3.10-arm
    commands:
      - go test -mod=vendor -v ./...
    environment:
      CGO_ENABLED: 0
      GO111MODULE: "on"

  - name: build
    image: golang:1.13-alpine3.10-arm
    commands:
      - go build -mod=vendor -o blog -v

  - name: push
    image: plugins/docker:linux-arm
    settings:
      registry: http://localhost:5000
      repo: localhost:5000/quantonganh/blog
      debug: true
      tags:
        - latest
        - ${DRONE_SOURCE_BRANCH}
